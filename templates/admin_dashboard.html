{% extends "base.html" %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4 text-white">
    <h2 class="fw-bold">Admin Dashboard</h2>
</div>

<div class="card shadow-sm p-3">

<table class="table table-bordered table-striped table-hover align-middle">

    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Issue</th>
            <th>Location</th>
            <th>Description</th>
            <th>Status</th>
            <th>Image</th>
            <th>Update Status</th>
        </tr>
    </thead>

    <tbody>
    {% for r in reports %}
        <tr>
            <td>{{ r.report_id }}</td>
            <td>{{ r.user_name }}</td>
            <td>{{ r.issue_type }}</td>
            <td>{{ r.location }}</td>
        <td style="max-width:200px;">{{ r.description }}</td>


            <td>
                {% if r.status == "Reported" %}
                    <span class="badge bg-warning text-dark">Reported</span>
                {% elif r.status == "In Progress" %}
                    <span class="badge bg-primary">In Progress</span>
                {% elif r.status == "Resolved" %}
                    <span class="badge bg-success">Resolved</span>
                {% endif %}
            </td>

           <td>
         {% if r.image_path %}
        <img src="{{ url_for('uploaded_file', filename=r.image_path) }}"
        class="img-thumbnail"
        style="width: 80px; height: 80px; object-fit: cover; cursor:pointer;"
        data-bs-toggle="modal"
        data-bs-target="#imageModal"
        onclick="showImage(this.src)">
        {% else %}
         No Image
        {% endif %}
         </td>


           <td>

{% if r.status != "Resolved" %}

    <form method="POST" action="/admin/update/{{ r.report_id }}">
        <div class="d-flex gap-2">

            <select name="status" class="form-select">
                <option value="Reported" {% if r.status=="Reported" %}selected{% endif %}>Reported</option>
                <option value="In Progress" {% if r.status=="In Progress" %}selected{% endif %}>In Progress</option>
                <option value="Resolved">Resolved</option>
            </select>

            <button class="btn btn-success">Update</button>

        </div>
    </form>

{% else %}

    <span class="badge bg-secondary fs-6">
        Issue Completed
    </span>

{% endif %}

</td>


        </tr>
    {% endfor %}
    </tbody>

</table>

</div>

<!-- Image Modal -->
<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Image of Issue</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center">
        <img id="modalImage" src="" class="img-fluid rounded">
      </div>

    </div>
  </div>
</div>

<script>
function showImage(src) {
    document.getElementById("modalImage").src = src;
}
</script>

{% endblock %}
