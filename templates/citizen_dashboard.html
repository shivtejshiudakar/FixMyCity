{% extends "base.html" %}

{% block content %}

<h2 class="fw-bold mb-3 text-white">
    Welcome {{ session['user_name'] }}
</h2>

<a href="/report" class="btn btn-success mb-4">
    Report New Issue
</a>

<div class="card shadow-sm p-3">

<table class="table table-bordered table-striped table-hover align-middle">

    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Issue</th>
            <th>Description</th>
            <th>Location</th>
            <th>Status</th>
            <th>Image</th>
            <th>Date</th>
            <th>Action</th>
        </tr>
        
    </thead>

    <tbody>
    {% for r in reports %}
        <tr>
            <td>{{ r.report_id }}</td>

            <td>{{ r.issue_type }}</td>

            <td style="max-width:250px;">
                {{ r.description }}
            </td>

            <td>{{ r.location }}</td>

            <td>
                {% if r.status == "Reported" %}
                    <span class="badge bg-warning text-dark">Reported</span>
                {% elif r.status == "In Progress" %}
                    <span class="badge bg-primary">In Progress</span>
                {% elif r.status == "Resolved" %}
                    <span class="badge bg-success">Resolved</span>
                {% endif %}
            </td>

            <td>
                {% if r.image_path %}
                    <img src="{{ url_for('uploaded_file', filename=r.image_path) }}"
                         class="img-thumbnail"
                         style="width: 70px; height: 70px; object-fit: cover; cursor:pointer;"
                         data-bs-toggle="modal"
                         data-bs-target="#imageModal"
                         onclick="showImage('{{ url_for('uploaded_file', filename=r.image_path) }}')">
                {% else %}
                    No Image
                {% endif %}
            </td>

            <td>{{ r.report_date }}</td>
            <td>
        {% if r.status != "Resolved" %}
         <form method="POST" action="/delete/{{ r.report_id }}"
          onsubmit="return confirm('Are you sure you want to delete this report?');">
        <button class="btn btn-danger btn-sm">Delete</button>
        </form>
        {% else %}
        <span class="text-muted">Locked</span>
        {% endif %}

        </td>

        </tr>
    {% endfor %}
    </tbody>

</table>

</div>


<!-- Image Modal -->
<div class="modal fade" id="imageModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Image of Issue</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center">
        <img id="modalImage" src="" class="img-fluid rounded">
      </div>

    </div>
  </div>
</div>

<script>
function showImage(src) {
    document.getElementById("modalImage").src = src;
}
</script>

{% endblock %}
